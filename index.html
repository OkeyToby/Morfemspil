<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Morfem-mysterie ‚Äì Klassemode (skjult liste + runde-kode)</title>
<style>
  :root{ --bg:#f1f5f9; --card:#ffffff; --ink:#0f172a; --muted:#475569; --accent:#2563eb; --ok:#16a34a; --err:#ef4444; --shadow:0 8px 24px rgba(2,6,23,.08); }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--ink);background:linear-gradient(180deg,#e2e8f0,#f8fafc)}
  .wrap{max-width:1000px;margin:0 auto;padding:16px 16px 80px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 14px}
  h1{margin:0;font-size:clamp(22px,4vw,34px)}
  .badge{background:#dbeafe;color:#1e3a8a;border-radius:999px;padding:6px 10px;font-weight:800}
  .panel{background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:14px;margin:12px 0}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .pill{padding:6px 10px;border-radius:999px;background:#e2e8f0;font-weight:800}
  .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:900;cursor:pointer;box-shadow:var(--shadow)}
  .primary{background:var(--accent);color:#fff}
  .ok{background:var(--ok);color:#fff}
  .ghost{background:#e2e8f0;color:#0f172a}
  .danger{background:var(--err);color:#fff}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(3,1fr)}
  .bucket{background:#ffffff;border-radius:14px;padding:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px;min-height:210px}
  .bucket h3{margin:0 0 6px;font-size:16px;color:var(--muted)}
  .chips{display:flex;flex-wrap:wrap;gap:8px;min-height:56px}
  .chip{user-select:none;padding:10px 14px;border-radius:999px;background:#eef2ff;color:#111827;border:2px solid #c7d2fe;font-weight:900;cursor:grab}
  .chip:active{cursor:grabbing}
  .answers{display:grid;gap:10px;grid-template-columns:repeat(3,1fr);margin-top:8px}
  .slot{background:#f8fafc;border:3px dashed #cbd5e1;border-radius:14px;height:60px;display:flex;align-items:center;justify-content:center;font-weight:900}
  .slot.full{background:#dcfce7;border-color:#16a34a}
  .found{display:flex;flex-wrap:wrap;gap:8px}
  .tag{background:#dcfce7;border:1px solid #16a34a;color:#052e16;padding:6px 10px;border-radius:999px;font-weight:800}
  .small{font-size:13px;color:var(--muted)}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111827;color:#fff;padding:10px 14px;border-radius:12px;opacity:0}
  .toast.show{opacity:1;transition:opacity .2s}
  .list{max-height:260px; overflow:auto; padding:6px; border:1px solid #e2e8f0;border-radius:10px;background:#fff}
  .list ul{margin:6px 0 0; padding-left:18px}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, monospace; font-size:12px; background:#e2e8f0; padding:2px 6px; border-radius:6px}
  input[type="text"]{border:2px solid #cbd5e1;border-radius:10px;padding:10px 12px;font-weight:700;min-width:220px}
  .teacher{display:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üïµÔ∏è‚Äç‚ôÄÔ∏è Morfem-mysterie <span class="badge">Klassemode</span></h1>
    <div class="row">
      <span class="pill">Point: <span id="score">0</span></span>
      <span class="pill">Fundet: <span id="foundN">0</span>/<span id="targetN">0</span></span>
    </div>
  </header>

  <div class="panel">
    <div class="row">
      <div class="small"><b>Runde-kode</b> (samme brikker p√• alle devices)</div>
      <input type="text" id="seedInput" placeholder="Fx: 6A-uge35" />
      <button class="btn primary" id="startSeed">Start runde</button>
      <button class="btn ghost" id="randomSeed">Tilf√¶ldig kode</button>
      <span class="small">Elever skriver den samme kode ‚Üí f√•r identiske brikker og ordmuligheder.</span>
    </div>
  </div>

  <div class="panel">
    <div class="small">Regel: Du kan skabe flere ord af brikkerne. Spillet accepterer alle **rigtige ord** fra ordbasen, som kan dannes af de aktuelle brikker.</div>
    <div class="answers">
      <div class="slot" data-slot="p">Pr√¶fiks</div>
      <div class="slot" data-slot="r">Rod</div>
      <div class="slot" data-slot="s">Suffiks</div>
    </div>
    <div class="row" style="margin-top:10px;">
      <button class="primary btn" id="check">Tjek ord ‚úÖ</button>
      <button class="ok btn" id="clear">Ryd felter</button>
      <button class="ghost btn" id="hint">Hint üí°</button>
      <span class="small">(+2 point pr. korrekt ord, +1 hvis der bruges hint)</span>
    </div>
  </div>

  <div class="panel">
    <div class="row">
      <div class="small">Eller skriv hele ordet (fx <i>ul√¶selig</i>) og tryk <span class="kbd">Enter</span>:</div>
      <input type="text" id="wordGuess" placeholder="Skriv ordet her‚Ä¶" />
      <button class="btn ghost" id="checkTyped">Tjek skrevet ord</button>
    </div>
  </div>

  <div class="grid">
    <div class="bucket">
      <h3>üü° Pr√¶fikser</h3>
      <div class="chips" id="bank-p"></div>
    </div>
    <div class="bucket">
      <h3>üü¢ R√∏dder</h3>
      <div class="chips" id="bank-r"></div>
    </div>
    <div class="bucket">
      <h3>üîµ Suffikser</h3>
      <div class="chips" id="bank-s"></div>
    </div>
  </div>

  <!-- L√¶rer-sektion (skjult for elever). √Öbnes med Ctrl+L og PIN. -->
  <div class="panel teacher" id="teacherPanel">
    <div class="row" style="justify-content:space-between;">
      <div class="small"><b>L√¶rer</b>: Alle ord der kan laves af disse brikker</div>
      <button class="ghost btn" id="toggleList">Skjul/Vis</button>
    </div>
    <div class="list" id="possible"></div>
  </div>

  <div class="panel">
    <div class="small">Ord du har fundet:</div>
    <div class="found" id="found"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ------------------- Ordbase: dansk -------------------
const ORDBOG = [
  {ord:"misforst√•", p:"mis", r:"forst√•", s:""},
  {ord:"genopbygger", p:"gen", r:"opbyg", s:"ger"},
  {ord:"uvenlig", p:"u", r:"ven", s:"lig"},
  {ord:"forst√•else", p:"", r:"forst√•", s:"else"},
  {ord:"l√¶sning", p:"", r:"l√¶s", s:"ning"},
  {ord:"skriver", p:"", r:"skriv", s:"er"},
  {ord:"venlighed", p:"", r:"venlig", s:"hed"},
  {ord:"ul√¶selig", p:"u", r:"l√¶s", s:"elig"},
  {ord:"overleve", p:"over", r:"lev", s:"e"},
  {ord:"genl√¶sning", p:"gen", r:"l√¶s", s:"ning"},
  {ord:"underbetalt", p:"under", r:"betal", s:"t"},
  {ord:"afslutning", p:"af", r:"slut", s:"ning"},
  {ord:"overtale", p:"over", r:"tale", s:""},
  {ord:"udtryk", p:"ud", r:"tryk", s:""},
  {ord:"indtryk", p:"ind", r:"tryk", s:""},
  {ord:"begrave", p:"be", r:"grav", s:"e"},
  {ord:"t√¶nksom", p:"", r:"t√¶nk", s:"som"},
  {ord:"brugbar", p:"", r:"brug", s:"bar"},
  {ord:"spiselig", p:"", r:"spis", s:"elig"},
  {ord:"forl√∏ber", p:"for", r:"l√∏b", s:"er"},
  {ord:"genbes√∏g", p:"gen", r:"bes√∏g", s:""},
  {ord:"udskrivning", p:"ud", r:"skriv", s:"ning"},
  {ord:"indbetaling", p:"ind", r:"betal", s:"ing"},
  {ord:"ombygning", p:"om", r:"byg", s:"ning"}
];

// ---------- Konfiguration ----------
const TEACHER_PIN = "1234"; // √¶ndr PIN her, hvis du vil

// ---------- Hj√¶lp ----------
const $ = q => document.querySelector(q);
const shuffle = arr => arr.map(x=>[x,Math.random()]).sort((a,b)=>a[1]-b[1]).map(x=>x[0]);
const uniq = arr => [...new Set(arr)];
function toast(msg){ const t=$("#toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"), 1000); }

// Seeded PRNG (mulberry32) for identiske s√¶t p√• tv√¶rs af devices
function xmur3(str){ for(var i=0,h=1779033703^str.length;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),3432918353);h=h<<13|h>>>19;} return function(){h=Math.imul(h^h>>>16,2246822507);h=Math.imul(h^h>>>13,3266489909); return (h^h>>>16)>>>0; } }
function mulberry32(a){ return function(){ var t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15, t|1); t^=t+Math.imul(t^t>>>7, t|61); return ((t^t>>>14)>>>0)/4294967296; } }
function seededShuffle(array, rand){ const a=array.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(rand()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function pickN(arr, n, rand){ const a=arr.slice(); const out=[]; while(out.length<n && a.length){ const i=Math.floor(rand()*a.length); out.push(a.splice(i,1)[0]); } return out; }

// ---------- State ----------
const state = { score:0, usedHint:false, found:new Set(), banks:{p:[],r:[],s:[]}, validNow:[], seed:"" };

// ---------- UI helpers ----------
function chip(label, slot){
  const b=document.createElement("button"); b.className="chip"; b.textContent=label; b.dataset.slot=slot;
  b.addEventListener("click", ()=>place(slot, label));
  return b;
}
function renderBanks(){
  ["p","r","s"].forEach(slot=>{
    const box=document.getElementById(`bank-${slot}`); box.innerHTML="";
    state.banks[slot].forEach(v=> box.appendChild(chip(v,slot)) );
  });
}
function clearSlots(){
  document.querySelectorAll(".slot").forEach(z=>{
    z.textContent = z.dataset.slot==="p"?"Pr√¶fiks": z.dataset.slot==="r"?"Rod":"Suffiks";
    z.classList.remove("full"); z.dataset.val="";
  });
}
function place(slot, value){
  const z=document.querySelector(`.slot[data-slot="${slot}"]`);
  z.textContent=value; z.classList.add("full"); z.dataset.val=value;
}
function getPick(){
  return {
    p: document.querySelector('.slot[data-slot="p"]').dataset.val || "",
    r: document.querySelector('.slot[data-slot="r"]').dataset.val || "",
    s: document.querySelector('.slot[data-slot="s"]').dataset.val || ""
  };
}
function updateHUD(){
  $("#score").textContent = state.score;
  $("#foundN").textContent = state.found.size;
  $("#targetN").textContent = state.validNow.length;
}

// ---------- Seedet nyt s√¶t ----------
function newSetFromSeed(seed){
  state.seed = seed;
  state.found.clear(); $("#found").innerHTML="";
  const hash = xmur3(seed)(); const rand = mulberry32(hash);

  // v√¶lg 6 ord deterministisk
  const pick = pickN(ORDBOG, 6, rand);

  let p = uniq(pick.map(x=>x.p).filter(Boolean));
  let r = uniq(pick.map(x=>x.r));
  let s = uniq(pick.map(x=>x.s).filter(Boolean));

  // Tilf√∏j forstyrrere deterministisk
  const allP = uniq(ORDBOG.map(x=>x.p).filter(Boolean));
  const allR = uniq(ORDBOG.map(x=>x.r));
  const allS = uniq(ORDBOG.map(x=>x.s).filter(Boolean));

  function add(arr, all, n){ const candidates = all.filter(v=>!arr.includes(v)); const extras = pickN(candidates, n, rand); return uniq([...arr, ...extras]); }
  state.banks = { p: seededShuffle(add(p, allP, 3), rand), r: seededShuffle(add(r, allR, 5), rand), s: seededShuffle(add(s, allS, 3), rand) };

  // Beregn alle gyldige ord ud fra banker (hele ordbasen), deterministisk r√¶kkef√∏lge
  state.validNow = ORDBOG.filter(o=>{
    const okP = (o.p===""? true : state.banks.p.includes(o.p));
    const okR = state.banks.r.includes(o.r);
    const okS = (o.s===""? true : state.banks.s.includes(o.s));
    return okP && okR && okS;
  });

  renderBanks(); clearSlots(); renderPossibleList(); updateHUD();
}

// ---------- L√¶rer-liste (skjult som standard) ----------
function renderPossibleList(){
  const box=$("#possible"); box.innerHTML="";
  const ul=document.createElement("ul"); ul.style.margin="6px 0 0"; ul.style.paddingLeft="18px";
  ul.innerHTML = state.validNow.map(o=>`<li>${o.ord} ‚Üí [${o.p||"‚àÖ"}] + <u>${o.r}</u> + [${o.s||"‚àÖ"}]</li>`).join("");
  box.appendChild(ul);
}

// ---------- Godkendelse ----------
function acceptWord(word){
  if(state.found.has(word)){ toast("Allerede fundet ‚úîÔ∏è"); return; }
  const gain = state.usedHint?1:2;
  state.score += gain;
  state.found.add(word);
  const tag=document.createElement("span"); tag.className="tag"; tag.textContent = word + (gain===1?" (+1)":" (+2)");
  $("#found").appendChild(tag);
  state.usedHint=false;
  updateHUD();
  toast("üéâ Rigtigt!");
}

function checkFromBrikker(){
  const {p,r,s} = getPick();
  if(!r){ toast("V√¶lg en rod."); return; }
  const hit = state.validNow.find(o => (p||"")===(o.p||"") && r===o.r && (s||"")===(o.s||""));
  if(hit){ acceptWord(hit.ord); clearSlots(); } else { toast("Ikke p√• listen over mulige ord."); }
}

function checkFromTyped(){
  const inp = $("#wordGuess");
  const val = (inp.value || "").trim().toLowerCase();
  if(!val){ toast("Skriv et ord."); return; }
  const hit = state.validNow.find(o => o.ord.toLowerCase()===val);
  if(hit){ acceptWord(hit.ord); inp.value=""; } else { toast("Det ord kan ikke dannes af brikkerne (eller er ikke i ordbasen)."); }
}

// ---------- Hint ----------
function hint(){
  state.usedHint = true;
  const rest = state.validNow.filter(o=>!state.found.has(o.ord));
  if(!rest.length){ toast("Alle ord fundet!"); return; }
  const t = rest[0];
  const rZ = document.querySelector('.slot[data-slot="r"]');
  if(!rZ.dataset.val){ place("r", t.r); toast("Hint: Roden er sat ind."); return; }
  const pZ = document.querySelector('.slot[data-slot="p"]');
  if(!pZ.dataset.val && t.p){ place("p", t.p); toast("Hint: Pr√¶fiks sat ind."); return; }
  const sZ = document.querySelector('.slot[data-slot="s"]');
  if(!sZ.dataset.val && t.s){ place("s", t.s); toast("Hint: Suffiks sat ind."); return; }
  toast("Ingen flere hints n√∏dvendige.");
}

// ---------- Teacher toggle (Ctrl+L) ----------
let teacherVisible = false;
function toggleTeacher(force=null){
  teacherVisible = (force!==null)? force : !teacherVisible;
  $("#teacherPanel").style.display = teacherVisible? "block" : "none";
}
document.addEventListener("keydown", (e)=>{
  if(e.ctrlKey && (e.key.toLowerCase()==="l")){
    e.preventDefault();
    const pin = prompt("L√¶rer-PIN (4 cifre):","");
    if(pin===TEACHER_PIN){ toggleTeacher(true); }
    else { alert("Forkert PIN."); }
  }
});

// ---------- Events ----------
document.getElementById("check").addEventListener("click", checkFromBrikker);
document.getElementById("clear").addEventListener("click", clearSlots);
document.getElementById("hint").addEventListener("click", hint);
document.getElementById("checkTyped").addEventListener("click", checkFromTyped);
document.getElementById("wordGuess").addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); checkFromTyped(); }});
document.getElementById("toggleList").addEventListener("click", ()=>{
  const el=$("#possible"); el.style.display = (el.style.display==="none" ? "block":"none");
});
document.getElementById("startSeed").addEventListener("click", ()=>{
  const seed = (document.getElementById("seedInput").value || "").trim();
  if(!seed){ toast("Skriv en runde-kode."); return; }
  newSetFromSeed(seed);
  // gem i URL s√• elever kan √•bne direkte: ?seed=...
  const url = new URL(window.location.href);
  url.searchParams.set("seed", seed);
  history.replaceState(null, "", url.toString());
});
document.getElementById("randomSeed").addEventListener("click", ()=>{
  const s = "R" + Math.random().toString(36).slice(2,6).toUpperCase();
  document.getElementById("seedInput").value = s;
  newSetFromSeed(s);
  const url = new URL(window.location.href); url.searchParams.set("seed", s); history.replaceState(null, "", url.toString());
});

// ---------- Init: l√¶s seed fra URL ----------
(function init(){
  const url = new URL(window.location.href);
  const seed = url.searchParams.get("seed") || "STANDARD-6A";
  document.getElementById("seedInput").value = seed;
  newSetFromSeed(seed);

  // L√¶rer auto-visning via URL ?teacher=1&pin=1234 (valgfrit)
  if(url.searchParams.get("teacher")==="1"){
    const pin = url.searchParams.get("pin");
    if(pin===TEACHER_PIN) toggleTeacher(true);
  }
})();
</script>
</body>
</html>
